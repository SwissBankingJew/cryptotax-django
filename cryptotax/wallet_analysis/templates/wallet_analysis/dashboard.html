{% extends "base.html" %}
{% load static %}

{% block title %}Dashboard - CryptoTax{% endblock %}

{% block content %}
<div class="row mb-4">
  <div class="col-12">
    <div class="d-flex justify-content-between align-items-center">
      <h1 class="h3 fw-bold mb-0">My Orders</h1>
      <a href="{% url 'wallet_analysis:create_order' %}" class="btn btn-gradient-solana">
        <i class="bi bi-plus-lg"></i> New Analysis
      </a>
    </div>
  </div>
</div>

{% if orders %}
<div class="row">
  <div class="col-12">
    <div class="card shadow-sm">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead class="table-light">
              <tr>
                <th class="px-4 py-3">Wallet Address</th>
                <th class="px-4 py-3">Status</th>
                <th class="px-4 py-3">Created</th>
                <th class="px-4 py-3">Reports</th>
                <th class="px-4 py-3">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for order in orders %}
              <tr>
                <td class="px-4 py-3">
                  <code class="text-dark">{{ order.wallet_address|truncatechars:16 }}</code>
                </td>
                <td class="px-4 py-3">
                  <span class="status-badge status-{{ order.status }}">
                    {{ order.get_status_display }}
                  </span>
                </td>
                <td class="px-4 py-3 text-muted">
                  {{ order.created_at|date:"M d, Y" }}
                </td>
                <td class="px-4 py-3">
                  {% if order.report_files.count > 0 %}
                    <span class="text-success fw-semibold">
                      <i class="bi bi-check-circle-fill"></i> {{ order.report_files.count }} ready
                    </span>
                  {% elif order.status == 'processing' %}
                    <span class="text-warning">
                      <i class="bi bi-hourglass-split"></i> Processing...
                    </span>
                  {% elif order.status == 'pending_payment' %}
                    <span class="text-muted">
                      <i class="bi bi-dash-circle"></i> Awaiting payment
                    </span>
                  {% else %}
                    <span class="text-muted">-</span>
                  {% endif %}
                </td>
                <td class="px-4 py-3">
                  <div class="btn-group" role="group">
                    {% if order.status == 'pending_payment' %}
                      <a href="{% url 'wallet_analysis:payment_page' order.id %}" class="btn btn-sm btn-primary">
                        Pay Now
                      </a>
                    {% else %}
                      <a href="{% url 'wallet_analysis:order_detail' order.id %}" class="btn btn-sm btn-outline-primary">
                        View Details
                      </a>
                    {% endif %}
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% else %}
<!-- Empty State -->
<div class="row justify-content-center">
  <div class="col-12 col-md-8 col-lg-6">
    <div class="card shadow-sm text-center">
      <div class="card-body py-5">
        <div class="mb-4">
          <i class="bi bi-inbox" style="font-size: 4rem; color: #ccc;"></i>
        </div>
        <h2 class="h4 fw-bold mb-3">No orders yet</h2>
        <p class="text-muted mb-4">
          Get started by analyzing your first wallet. It only takes a few minutes!
        </p>
        <a href="{% url 'wallet_analysis:create_order' %}" class="btn btn-gradient-solana btn-lg px-5">
          Analyze Your First Wallet
        </a>
      </div>
    </div>
  </div>
</div>
{% endif %}

{% endblock %}
